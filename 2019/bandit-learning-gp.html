<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8"/>
  <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=None">
  </script>
  <script>
   window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'None');
  </script>
  <meta content="" name="description"/>
  <meta content="Hemanta Sharma" name="author"/>
  <title>
   Active Learning and Multi-Arm Bandits
  </title>
  <link href="../../assets/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="../../assets/css/custom.css" rel="stylesheet"/>
  <script async="" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_HTML" type="text/javascript">
  </script>
  <!-- MathJax configuration -->
  <script type="text/x-mathjax-config">
   MathJax.Hub.Config({
                tex2jax: {
                    inlineMath: [ ["$","$"], ["\\(","\\)"] ],
                    displayMath: [ ["$$",'$$'], ["\\[","\\]"] ],
                    processEscapes: true,
                    processEnvironments: true
                },
                // Center justify equations in code and markdown cells. Elsewhere
                // we use CSS to left justify single line equations in code cells.
                displayAlign: 'center',
                "HTML-CSS": {
                    styles: {'.MathJax_Display': {"margin": 0}},
                    linebreaks: { automatic: true }
                }
            });
  </script>
 </head>
 <body>
  <nav class="navbar navbar-default">
   <div class="container text-center">
    <div class="navbar-collapse" id="navbar">
     <ul class="nav navbar-nav">
      <li>
       <a href="../../index.html">
        Home
       </a>
      </li>
      <li>
       <a href="../index.html">
        Blog
       </a>
      </li>
      <li>
       <a href="../../projects.html/">
        Projects
       </a>
      </li>
     </ul>
    </div>
   </div>
  </nav>
  <div id="content">
   <div class="cell border-box-sizing text_cell rendered">
    <div class="prompt input_prompt">
    </div>
    <div class="inner_cell">
     <div class="text_cell_render border-box-sizing rendered_html">
      <h1 id="Active-Learning-and-Multi-Arm-Bandits">
       Active Learning and Multi-Arm Bandits
       <a class="anchor-link" href="#Active-Learning-and-Multi-Arm-Bandits">
        &para;
       </a>
      </h1>
      <p>
       In this post, we are going to focus on two tasks, active learning - where we query the user/oracle to label samples; and the multi-arm bandit - where we again query the user/Oracle which returns us a scalar reward. We will be trying to pose the problems first and then talk about some of the ways to solve these problems.
      </p>
      <p>
       The primary motivation behind active learning is the expensive cost of labeling in machine learning tasks.
      </p>
      <h2 id="Mining-Gold!">
       Mining Gold!
       <a class="anchor-link" href="#Mining-Gold!">
        &para;
       </a>
      </h2>
      <p>
       Let us explain the two problems using the gold mining application.
We will, for now, look at only one-dimensional locations, i.e., we are talking gold distribution only about a line.
The issue we have is that at the start of the activity, we have no idea about the amount of gold at different locations.
The only way we can get the information about the amount of gold is by drilling at a location.
This drilling is costly and involves expensive sensors to be used.
We, therefore, want to minimize the number of drillings that we require.
      </p>
      <p>
       We below show two of the common objectives for the gold mining problem.
      </p>
      <ul>
       <li>
        <p>
         <strong>
          Problem 1: Best Estimate of Gold Distribution
         </strong>
         In this problem, we are supposed to estimate the amount of gold on the one-dimensional line. But we can not drill at every location. We should drill at those locations that provide us the "maximum" information about the distribution of the gold.
        </p>
       </li>
       <li>
        <p>
         <strong>
          Problem 2: Location of Maximum Gold
         </strong>
         In this problem, we are supposed to find the location in the one-dimensional space where the gold quantity is the maximum. This problem focuses on finding the location with the most gold content.
        </p>
       </li>
      </ul>
      <p>
       <img alt="" src="../images/2019/bandit-learning-gp/active-gp.gif"/>
      </p>
      <hr/>
      <p>
       <img alt="" src="../images/2019/bandit-learning-gp/mab-gp-pi-eps0.5.gif"/>
      </p>
      <ul>
       <li>
        <p>
         Here are representative animations showing the process of drilling at new locations and to reduce the uncertainty and get the best predictions showcasing the Active Learning problem.
        </p>
       </li>
       <li>
        <p>
         And drilling at locations to get the location of the maximum gold reserve, showcasing the Multi Armed Bandit problem
        </p>
       </li>
      </ul>
      <p>
       We will build the solution to both of these problems from the ground up.
      </p>
      <h4 id="Some-imports">
       Some imports
       <a class="anchor-link" href="#Some-imports">
        &para;
       </a>
      </h4>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[1]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">itertools</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">sklearn.gaussian_process.kernels</span> <span class="kn">import</span> <span class="n">Matern</span>
<span class="kn">from</span> <span class="nn">sklearn.gaussian_process</span> <span class="kn">import</span> <span class="n">GaussianProcessRegressor</span>
<span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">ndtr</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">'ignore'</span><span class="p">)</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing text_cell rendered">
    <div class="prompt input_prompt">
    </div>
    <div class="inner_cell">
     <div class="text_cell_render border-box-sizing rendered_html">
      <h4 id="Prettyfing-Matplotlib-plots">
       Prettyfing Matplotlib plots
       <a class="anchor-link" href="#Prettyfing-Matplotlib-plots">
        &para;
       </a>
      </h4>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[2]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="n">SPINE_COLOR</span> <span class="o">=</span> <span class="s1">'gray'</span>

<span class="k">def</span> <span class="nf">format_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">spine</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'top'</span><span class="p">,</span> <span class="s1">'right'</span><span class="p">]:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">spine</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">spine</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'left'</span><span class="p">,</span> <span class="s1">'bottom'</span><span class="p">]:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">spine</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">SPINE_COLOR</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">spine</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">'bottom'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">'left'</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="p">]:</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s1">'out'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">SPINE_COLOR</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ax</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing text_cell rendered">
    <div class="prompt input_prompt">
    </div>
    <div class="inner_cell">
     <div class="text_cell_render border-box-sizing rendered_html">
      <h3 id="Active-Learning">
       Active Learning
       <a class="anchor-link" href="#Active-Learning">
        &para;
       </a>
      </h3>
      <p>
       <strong>
        Problem 1
       </strong>
       is very similar to problems we like to solve using active learning. Active learning is used to predict distribution by reducing uncertainty. One of the ways we can reduce the uncertainty is by choosing the point at which we have the maximum variance (we are most uncertain).
      </p>
      <h3 id="Gaussian-Processes">
       Gaussian Processes
       <a class="anchor-link" href="#Gaussian-Processes">
        &para;
       </a>
      </h3>
      <p>
       In our previous post,
       <a href="GP-1.html">
        here
       </a>
       ; we had introduced the Gaussian Process. As you can remember, we use Gaussian Processes to get a prediction as well as the attached uncertainty (variance) with that prediction. This will turn out to be useful for us, as we wanted to drill where we were most uncertain. By using Gaussian processes, we take some very naive assumption that the gold distribution of nearby points in similar (smoothness).
      </p>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing text_cell rendered">
    <div class="prompt input_prompt">
    </div>
    <div class="inner_cell">
     <div class="text_cell_render border-box-sizing rendered_html">
      <h4 id="Creating-ground-truth-data">
       Creating ground truth data
       <a class="anchor-link" href="#Creating-ground-truth-data">
        &para;
       </a>
      </h4>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[3]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">"""The function to predict."""</span>
    <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="mi">3</span><span class="p">)))</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">x</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing text_cell rendered">
    <div class="prompt input_prompt">
    </div>
    <div class="inner_cell">
     <div class="text_cell_render border-box-sizing rendered_html">
      <p>
       Let us now try to see how our groundtruth data looks like.
      </p>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[4]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">600</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">'purple'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'GT'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"X"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Gold content"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Ground Truth for Gold Content"</span><span class="p">)</span>
<span class="n">format_axes</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">'MAB_gifs/GT.svg'</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">"tight"</span><span class="p">)</span>
</pre>
       </div>
      </div>
     </div>
    </div>
    <div class="output_wrapper">
     <div class="output">
      <div class="output_area">
       <div class="prompt">
       </div>
       <div class="output_png output_subarea">
        <img src="../images/2019/bandit-learning-gp/image_3.png"/>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing text_cell rendered">
    <div class="prompt input_prompt">
    </div>
    <div class="inner_cell">
     <div class="text_cell_render border-box-sizing rendered_html">
      <h4 id="Prior-Model">
       Prior Model
       <a class="anchor-link" href="#Prior-Model">
        &para;
       </a>
      </h4>
      <p>
       Our prior model doesn't know much and assumes a smooth relationship between points via an Matern kernel. The Grey line in the graph below denotes the knowledge we have about the gold content without drilling even at a single location.
      </p>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[5]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="n">kernel</span> <span class="o">=</span> <span class="n">Matern</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="c1"># kernel = None</span>
<span class="n">gp</span> <span class="o">=</span> <span class="n">GaussianProcessRegressor</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span><span class="p">)</span>
<span class="n">y_pred</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">return_std</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="s1">'k'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Predicted'</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">'purple'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'GT'</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"X"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Gold content"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">y_pred</span><span class="o">+</span><span class="n">sigma</span><span class="p">,</span> <span class="n">y_pred</span><span class="o">-</span><span class="n">sigma</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'gray'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">format_axes</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">'MAB_gifs/prior.svg'</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">"tight"</span><span class="p">)</span>
</pre>
       </div>
      </div>
     </div>
    </div>
    <div class="output_wrapper">
     <div class="output">
      <div class="output_area">
       <div class="prompt">
       </div>
       <div class="output_png output_subarea">
        <img src="../images/2019/bandit-learning-gp/image_4.png"/>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing text_cell rendered">
    <div class="prompt input_prompt">
    </div>
    <div class="inner_cell">
     <div class="text_cell_render border-box-sizing rendered_html">
      <p>
       Also, take notice that the confidence (uncertainty) about the gold content is also the same for every location.
      </p>
      <h4 id="Adding-Training-Data">
       Adding Training Data
       <a class="anchor-link" href="#Adding-Training-Data">
        &para;
       </a>
      </h4>
      <p>
       Let us now add a point to the train set or in other words, drill one of the locations and see the gold content (
       <code>
        y
       </code>
       ). We can see how our confidence and our estimates change after we get this first information by fitting the model to the new data. I am going to add
       <code>
        (x = 0.5, y = f(0.5))
       </code>
       into the train set now.
      </p>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[6]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="n">train_X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">([</span><span class="mf">0.5</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="n">train_y</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">train_X</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="n">gp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">)</span>
<span class="n">y_pred</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">return_std</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="s1">'k'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Predicted'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">'purple'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'GT'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"X"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Gold content"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">y_pred</span><span class="o">+</span><span class="n">sigma</span><span class="p">,</span> <span class="n">y_pred</span><span class="o">-</span><span class="n">sigma</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'gray'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">'$\mu \pm \sigma$'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Last Added Point'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.04</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s2">"upper left"</span><span class="p">)</span>
<span class="n">format_axes</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">'MAB_gifs/posterior.svg'</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">"tight"</span><span class="p">)</span>
</pre>
       </div>
      </div>
     </div>
    </div>
    <div class="output_wrapper">
     <div class="output">
      <div class="output_area">
       <div class="prompt">
       </div>
       <div class="output_png output_subarea">
        <img src="../images/2019/bandit-learning-gp/image_5.png"/>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing text_cell rendered">
    <div class="prompt input_prompt">
    </div>
    <div class="inner_cell">
     <div class="text_cell_render border-box-sizing rendered_html">
      <p>
       Nice! We see now that the posterior has changed and we are very certain about the gold content in the vicinity of
       <code>
        x = 0.5
       </code>
       , but, very uncertain far away from it. Also, we can see that the mean of the point closer to
       <code>
        x = 0.5
       </code>
       is closer to the value that we got from drilling and seeing the gold content. So, we now come to the key idea.
      </p>
      <h4 id="Active-Learning-Procedure">
       Active Learning Procedure
       <a class="anchor-link" href="#Active-Learning-Procedure">
        &para;
       </a>
      </h4>
      <ol>
       <li>
        Choose the point of having the highest uncertainty
       </li>
       <li>
        Add the point to train set
       </li>
       <li>
        Train on the new train set
       </li>
       <li>
        Go to 1 till convergence or budget elapsed
       </li>
      </ol>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[7]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="c1"># Stopping criteria is 10 iterations</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="c1"># Fit on current train set</span>
    <span class="n">gp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
    <span class="c1"># predict on current pool set</span>
    <span class="n">y_pred</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">return_std</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="s1">'k'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Predicted'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">'purple'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'GT'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"X"</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Gold content"</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">y_pred</span><span class="o">+</span><span class="n">sigma</span><span class="p">,</span> <span class="n">y_pred</span><span class="o">-</span><span class="n">sigma</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'gray'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">'$\mu \pm \sigma$'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">train_X</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">train_y</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Train points'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">train_X</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">train_y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Query Point'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.04</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s2">"upper left"</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Iteration: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">format_axes</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
    <span class="n">dirName</span> <span class="o">=</span> <span class="s1">'active-gp-img'</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dirName</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">dirName</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.png"</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">"tight"</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="c1"># Choose the next point with highest sigma</span>
    <span class="n">next_ix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span>
    <span class="n">next_x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">next_ix</span><span class="p">]</span>
    <span class="c1"># Add new point with highest uncertainty to the pool set</span>
    <span class="n">train_X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">train_X</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">next_ix</span><span class="p">]]])</span>
    <span class="n">train_y</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">train_X</span><span class="p">)</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing text_cell rendered">
    <div class="prompt input_prompt">
    </div>
    <div class="inner_cell">
     <div class="text_cell_render border-box-sizing rendered_html">
      <p>
       Let us now automate this process and see how our posterior changes at every iteration where we add a sensor. For each of our iteration below, the prior was the Gaussian Process learned on the points already in the training set. We have recreated the 1st animation at the top of the post!
      </p>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[8]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="err">!</span><span class="n">convert</span> <span class="o">-</span><span class="n">delay</span> <span class="mi">40</span> <span class="o">-</span><span class="n">loop</span> <span class="mi">0</span> <span class="n">active</span><span class="o">-</span><span class="n">gp</span><span class="o">-</span><span class="n">img</span><span class="o">/*.</span><span class="n">png</span> <span class="n">MAB_gifs</span><span class="o">/</span><span class="n">active</span><span class="o">-</span><span class="n">gp</span><span class="o">.</span><span class="n">gif</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing text_cell rendered">
    <div class="prompt input_prompt">
    </div>
    <div class="inner_cell">
     <div class="text_cell_render border-box-sizing rendered_html">
      <p>
       <img alt="" src="../images/2019/bandit-learning-gp/active-gp.gif"/>
      </p>
      <p>
       There you go we have recreated one of the plots from the starting of the blog! One point to notice is that this idea of choosing the most uncertain location leads to querying of the points that are the farthest (visible when we choose the 2nd location to drill). This might not be so good as we are kind of wasting our drillings because they are at the boundary of the 1-dimensional plot.
      </p>
      <hr/>
      <h3 id="Multi-Armed-Bandit">
       Multi-Armed Bandit
       <a class="anchor-link" href="#Multi-Armed-Bandit">
        &para;
       </a>
      </h3>
      <p>
       <strong>
        Problem 2
       </strong>
       requires us to find the location where the gold content is maximum. Even though the problem setting may be similar, the objective is quite different than problem 1. In other words, we just want the location where we can drill to get the most gold.
      </p>
      <p>
       Older problem - Earlier in the active learning problem, our motivation for drilling at locations was to predict the distribution of the gold content over all the locations in the one-dimensional line. We, therefore, had chosen the next location to drill where we had maximum uncertainty about our estimate.
      </p>
      <p>
       In this problem, we are instead interested to know the location at which we find the maximum gold. For getting the location of maximum gold content, we might want to drill at the location where predicted mean is the highest (exploit). But unfortunately our mean is not always accurate, so we need to correct our mean (reduce variance / explore) too. Multi-Arm Bandit looks at both exploitation and exploration, whereas in the case of Active Learning Problem, we only cared about exploration.
      </p>
      <h4 id="Acquisition-Functions">
       Acquisition Functions
       <a class="anchor-link" href="#Acquisition-Functions">
        &para;
       </a>
      </h4>
      <p>
       Now, to take into account the combination of exploration and exploitation, we try to use a function which combines the two sides. These utility functions that take into account both exploration and exploitation in multi-arm bandit problem are called acquisition functions.
      </p>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[9]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="k">class</span> <span class="nc">ACQ</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">acq_fn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">raise</span> <span class="bp">NotImplemented</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">acq_fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">ACQ1</span><span class="p">(</span><span class="n">ACQ</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">acq_fn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gp_reg</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">lam</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span> <span class="o">**</span><span class="n">kwrags</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        gp_reg: sklearn.GPRegresssor</span>
<span class="sd">        lam: float, where the objective is: \mu(x) + \lambda \sigma(x)</span>
<span class="sd">        """</span>
        <span class="n">y_pred</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">gp_reg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">return_std</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">y_pred</span> <span class="o">+</span> <span class="n">lam</span><span class="o">*</span><span class="n">sigma</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[10]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="n">acq_obj</span> <span class="o">=</span> <span class="n">ACQ1</span><span class="p">()</span>

<span class="n">train_X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">([</span><span class="mf">0.5</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="n">train_y</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">train_X</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="n">gp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">)</span>
<span class="n">y_pred</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">return_std</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="s1">'k'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Predicted'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">'purple'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'GT'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"X"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Gold content"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">y_pred</span><span class="o">+</span><span class="n">sigma</span><span class="p">,</span> <span class="n">y_pred</span><span class="o">-</span><span class="n">sigma</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'gray'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">'$\mu \pm \sigma$'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Train points'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">acq_obj</span><span class="p">(</span><span class="n">gp</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Acquisition function'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'green'</span><span class="p">)</span>
<span class="n">format_axes</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.04</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s2">"upper left"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">"MAB_gifs/acq_fn.svg"</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">"tight"</span><span class="p">)</span>
</pre>
       </div>
      </div>
     </div>
    </div>
    <div class="output_wrapper">
     <div class="output">
      <div class="output_area">
       <div class="prompt">
       </div>
       <div class="output_png output_subarea">
        <img src="../images/2019/bandit-learning-gp/image_7.png"/>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing text_cell rendered">
    <div class="prompt input_prompt">
    </div>
    <div class="inner_cell">
     <div class="text_cell_render border-box-sizing rendered_html">
      <p>
       Here, we can see that mean near the location of the just added point (red point) is high. But as we go far from the red point, we see that our uncertainty increases to a maximum. As we discussed in multi-arm bandit problem, we like to have some combination of exploration and exploitation. The most basic way to do so is by linearly combining the two values.
      </p>
      <h3 id="ACQ1">
       ACQ1
       <a class="anchor-link" href="#ACQ1">
        &para;
       </a>
      </h3>
      <p>
       This combined value that takes into account exploration and exploitation is referred to as the acquisition value, returned by acquisition function. We see at around the location
       <code>
        x = 1.4
       </code>
       we get the maximum value for the acquisition (green curve). Thus we next select this location to drill.
      </p>
      <p>
       The intuition of using the acquisition function
       <code>
        mean + lam * uncertainty
       </code>
       is that we are interested in finding the global mean, so taking into account the estimated mean would be a good idea. Additionally, we would like to explore too (using
       <code>
        lam
       </code>
       ); else we might be stuck in a local minimum if don't explore too much (see below).
      </p>
      <p>
       We define a big plotting function below for saving us the trouble down the road.
      </p>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[11]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="k">def</span> <span class="nf">rargmax</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
    <span class="sd">"""Randomly tie breaking argmax"""</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flatnonzero</span><span class="p">(</span><span class="n">b</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>

<span class="k">def</span> <span class="nf">plot_acquisition</span><span class="p">(</span>
        <span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span>
        <span class="n">acq_class</span><span class="p">,</span> <span class="n">acq_params</span><span class="o">=</span><span class="p">{},</span>
        <span class="n">ylim0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlim0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">ylim1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlim1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">y1scale</span><span class="o">=</span><span class="s1">'linear'</span><span class="p">,</span> <span class="n">it</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">seed</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="p">):</span>
    <span class="sd">"""acq_params would contain the parameters for our acq_fn"""</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="c1"># for storing the max till it iters</span>
    <span class="n">max_till_now</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># Stopping criteria is 10 iterations</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">it</span><span class="p">):</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="n">y1scale</span><span class="p">)</span>
        
        <span class="c1"># limits</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim0</span><span class="p">)</span> <span class="k">if</span> <span class="n">ylim0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-.</span><span class="mi">5</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">+.</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim0</span><span class="p">)</span> <span class="k">if</span> <span class="n">xlim0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-.</span><span class="mi">5</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+.</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim1</span><span class="p">)</span> <span class="k">if</span> <span class="n">ylim1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim1</span><span class="p">)</span> <span class="k">if</span> <span class="n">xlim1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-.</span><span class="mi">5</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+.</span><span class="mi">5</span><span class="p">)</span>
        
        <span class="c1"># fitting</span>
        <span class="n">gp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
        
        <span class="c1"># plot Acquisition</span>
        <span class="n">acq_obj</span> <span class="o">=</span> <span class="n">acq_class</span><span class="p">()</span>
        <span class="n">acquisition</span> <span class="o">=</span> <span class="n">acq_obj</span><span class="p">(</span><span class="n">gp</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">acq_params</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">train_y</span><span class="p">))</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">acquisition</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Acquisition function'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'green'</span><span class="p">)</span>
        
        <span class="c1"># predict on current pool set</span>
        <span class="n">y_pred</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">return_std</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="s1">'k'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Predicted'</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">'purple'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'GT'</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"X"</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"Gold content"</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">y_pred</span><span class="o">+</span><span class="n">sigma</span><span class="p">,</span>
                           <span class="n">y_pred</span><span class="o">-</span><span class="n">sigma</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'gray'</span><span class="p">,</span>
                           <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">'$\mu \pm \sigma$'</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                      <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Train points'</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.04</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s2">"upper left"</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">acq_obj</span><span class="p">))</span>
        <span class="n">hyperparams</span> <span class="o">=</span> <span class="s1">' | '</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="s1">': '</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">acq_params</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Iteration: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> &amp; HParam(s) &rarr; "</span> <span class="o">+</span> <span class="n">hyperparams</span><span class="p">)</span>
        
        <span class="c1"># Choose the next point with highest sigma</span>
        <span class="n">max_mu</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">train_y</span><span class="p">)</span>
        <span class="n">max_till_now</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_mu</span><span class="p">)</span>
        <span class="n">next_ix</span> <span class="o">=</span> <span class="n">rargmax</span><span class="p">(</span><span class="n">acquisition</span><span class="p">)</span>
        <span class="n">next_x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">next_ix</span><span class="p">]</span>

        <span class="c1"># Add new point with highest uncertainty to the pool set</span>
        <span class="n">train_X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">train_X</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">next_ix</span><span class="p">]]])</span>
        <span class="n">train_y</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">train_X</span><span class="p">)</span>

        <span class="c1"># Add new point with highest uncertainty to the pool set</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">next_ix</span><span class="p">],</span> <span class="n">acquisition</span><span class="p">[</span><span class="n">next_ix</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">'X'</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                      <span class="n">c</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'maxima (tie randomly broken)'</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">next_ix</span><span class="p">],</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">next_ix</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span>
                      <span class="n">s</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Query Point'</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s2">"upper left"</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.1</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s2">"upper left"</span><span class="p">)</span>
        <span class="n">train_X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">train_X</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">next_ix</span><span class="p">]]])</span>
        <span class="n">train_y</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">train_X</span><span class="p">)</span>
        <span class="n">format_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">format_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">acq_params_str</span> <span class="o">=</span> <span class="s1">'-'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">acq_params</span><span class="o">.</span><span class="n">values</span><span class="p">())))</span>
        <span class="n">dirName</span> <span class="o">=</span> <span class="s1">'./MAB_pngs/'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">acq_obj</span><span class="p">)</span><span class="o">+</span><span class="s1">'/'</span><span class="o">+</span><span class="n">acq_params_str</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dirName</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">dirName</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.png"</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">"tight"</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">dirName</span><span class="p">,</span> <span class="n">max_till_now</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[12]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="n">gifDir</span> <span class="o">=</span> <span class="s1">'MAB_gifs'</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">gifDir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">train_X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">([</span><span class="mf">0.5</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="n">train_y</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">train_X</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[13]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="n">acq_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'lam'</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>

<span class="n">dirName</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plot_acquisition</span><span class="p">(</span>
    <span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span>
    <span class="n">ACQ1</span><span class="p">,</span> <span class="n">acq_params</span><span class="p">,</span>
    <span class="n">ylim1</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># gify</span>
<span class="err">!</span><span class="n">convert</span> <span class="o">-</span><span class="n">delay</span> <span class="mi">40</span> <span class="o">-</span><span class="n">loop</span> <span class="mi">0</span> <span class="p">{</span><span class="n">dirName</span><span class="p">}</span><span class="o">/*.</span><span class="n">png</span> <span class="p">{</span><span class="n">gifDir</span><span class="p">}</span><span class="o">/</span><span class="n">mab</span><span class="o">-</span><span class="n">gp</span><span class="o">-</span><span class="mf">1.</span><span class="n">gif</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing text_cell rendered">
    <div class="prompt input_prompt">
    </div>
    <div class="inner_cell">
     <div class="text_cell_render border-box-sizing rendered_html">
      <p>
       Let us now try different hyperparameters for
       <code>
        ACQ1
       </code>
       . We can see that on increasing
       <code>
        lam
       </code>
       we "explore" more! In the below case we can easily see since we didn't give too much importance to the uncertainty (low
       <code>
        lam
       </code>
       ) we got stuck in local minima.
      </p>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing text_cell rendered">
    <div class="prompt input_prompt">
    </div>
    <div class="inner_cell">
     <div class="text_cell_render border-box-sizing rendered_html">
      <p>
       <img alt="" src="../images/2019/bandit-learning-gp/mab-gp-1.gif"/>
      </p>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[14]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="n">acq_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'lam'</span><span class="p">:</span> <span class="mi">5</span><span class="p">}</span>

<span class="n">dirName</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plot_acquisition</span><span class="p">(</span>
    <span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span>
    <span class="n">ACQ1</span><span class="p">,</span> <span class="n">acq_params</span><span class="p">,</span>
    <span class="n">ylim1</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="p">)</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[15]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="err">!</span><span class="n">convert</span> <span class="o">-</span><span class="n">delay</span> <span class="mi">40</span> <span class="o">-</span><span class="n">loop</span> <span class="mi">0</span> <span class="p">{</span><span class="n">dirName</span><span class="p">}</span><span class="o">/*.</span><span class="n">png</span> <span class="p">{</span><span class="n">gifDir</span><span class="p">}</span><span class="o">/</span><span class="n">mab</span><span class="o">-</span><span class="n">gp</span><span class="o">-</span><span class="mf">5.</span><span class="n">gif</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing text_cell rendered">
    <div class="prompt input_prompt">
    </div>
    <div class="inner_cell">
     <div class="text_cell_render border-box-sizing rendered_html">
      <p>
       Below we can see that this choice of
       <code>
        lam = 5
       </code>
       is still a little smaller than we like (we would like to see that we get to exploit the location where the gold is the most.).
      </p>
      <p>
       <img alt="" src="../images/2019/bandit-learning-gp/mab-gp-5.gif"/>
      </p>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[16]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="n">acq_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'lam'</span><span class="p">:</span> <span class="mi">10</span><span class="p">}</span>

<span class="n">dirName</span><span class="p">,</span> <span class="n">mtn_acq</span> <span class="o">=</span> <span class="n">plot_acquisition</span><span class="p">(</span>
    <span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span>
    <span class="n">ACQ1</span><span class="p">,</span> <span class="n">acq_params</span><span class="p">,</span>
    <span class="n">ylim1</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">14</span><span class="p">)</span>
<span class="p">)</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[17]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="err">!</span><span class="n">convert</span> <span class="o">-</span><span class="n">delay</span> <span class="mi">40</span> <span class="o">-</span><span class="n">loop</span> <span class="mi">0</span> <span class="p">{</span><span class="n">dirName</span><span class="p">}</span><span class="o">/*.</span><span class="n">png</span> <span class="p">{</span><span class="n">gifDir</span><span class="p">}</span><span class="o">/</span><span class="n">mab</span><span class="o">-</span><span class="n">gp</span><span class="o">-</span><span class="mf">10.</span><span class="n">gif</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing text_cell rendered">
    <div class="prompt input_prompt">
    </div>
    <div class="inner_cell">
     <div class="text_cell_render border-box-sizing rendered_html">
      <p>
       Perfect! We see that setting this value of
       <code>
        lam = 10
       </code>
       resulted in finding points near the global maxima and not getting stuck in a local maximum.
      </p>
      <p>
       <img alt="" src="../images/2019/bandit-learning-gp/mab-gp-10.gif"/>
      </p>
      <hr/>
      <h3 id="Random">
       Random
       <a class="anchor-link" href="#Random">
        &para;
       </a>
      </h3>
      <p>
       We had used a little intelligent acquisition function earlier, let's see is out acquisition function is not that intelligent and chooses randomly.
      </p>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[18]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="k">class</span> <span class="nc">Rand</span><span class="p">(</span><span class="n">ACQ</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">acq_fn</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">gp_reg</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        gp_reg: sklearn.GPRegresssor</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[19]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="n">dirName</span><span class="p">,</span> <span class="n">mtn_rand</span> <span class="o">=</span> <span class="n">plot_acquisition</span><span class="p">(</span>
    <span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span>
    <span class="n">Rand</span><span class="p">,</span> <span class="n">ylim1</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># gify</span>
<span class="err">!</span><span class="n">convert</span> <span class="o">-</span><span class="n">delay</span> <span class="mi">40</span> <span class="o">-</span><span class="n">loop</span> <span class="mi">0</span> <span class="p">{</span><span class="n">dirName</span><span class="p">}</span><span class="o">/*.</span><span class="n">png</span> <span class="p">{</span><span class="n">gifDir</span><span class="p">}</span><span class="o">/</span><span class="n">rand</span><span class="o">.</span><span class="n">gif</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing text_cell rendered">
    <div class="prompt input_prompt">
    </div>
    <div class="inner_cell">
     <div class="text_cell_render border-box-sizing rendered_html">
      <p>
       We have here implemented a random method as a baseline. Notice, random method can find a location near the global maximum but is not able to exploit (try to find the global maxima that might be near this "best" location). Instead, it randomly chooses to explore (not even intelligently) here and there. Even with no intelligent, we might get good locations which might be close to the location with the most gold content.
      </p>
      <p>
       <img alt="" src="../images/2019/bandit-learning-gp/rand.gif"/>
      </p>
      <hr/>
      <h3 id="Probability-of-Improvement-(PI)">
       Probability of Improvement (PI)
       <a class="anchor-link" href="#Probability-of-Improvement-(PI)">
        &para;
       </a>
      </h3>
      <p>
       Let us look into our next method for the MAB maximisation problem. As before, we want to balance or trade-off between exploration and exploitation. The idea behind the algorithm is fairly simple - choose the next point as the one which has the highest probability of improvement over the current max ($\mu^+$).
      </p>
      <p>
       Let's understand this concept via two cases:
      </p>
      <ol>
       <li>
        We have two points of similar means (of function values (gold in our case)). We now want to choose one of these to obtain the labels or values. We will choose the one with higher variance. This basically says that given same exploitability, we choose the one with higher exploration value.
       </li>
       <li>
        We have two points having same variance. We would now choose the point with the higher mean. This basically says that given same explorability, we will choose the one with higher exploitation value.
       </li>
      </ol>
      <ol>
       <li>
        Let $\mu^+$ be the current highest value of the function
       </li>
       <li>
        Let $\epsilon$ be close to zero
       </li>
       <li>
        Choose $x^* = arg\,max(P(f(x)) &gt; (\mu^+ +\epsilon))$
       </li>
      </ol>
      <p>
       This can be given as: $x^* = _{arg\,max_{x}} \Phi(\frac{\mu(x) - \mu^+ - \epsilon}{\sigma(x)})$ where
$\Phi(.)$ indicates the CDF.
      </p>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[20]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="c1"># Code is heavily borrowed from: https://modal-python.readthedocs.io/</span>
<span class="c1"># en/latest/_modules/modAL/acquisition.html#max_PI</span>
<span class="k">class</span> <span class="nc">PI</span><span class="p">(</span><span class="n">ACQ</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">acq_fn</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">gp_reg</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mf">5.</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        gp_reg: sklearn.GPRegresssor</span>
<span class="sd">        """</span>
        <span class="n">y_pred</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">gp_reg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">return_std</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">cdf</span> <span class="o">=</span> <span class="n">ndtr</span><span class="p">((</span><span class="n">y_pred</span> <span class="o">-</span> <span class="n">mu</span> <span class="o">-</span> <span class="n">eps</span><span class="p">)</span><span class="o">/</span><span class="n">sigma</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cdf</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing text_cell rendered">
    <div class="prompt input_prompt">
    </div>
    <div class="inner_cell">
     <div class="text_cell_render border-box-sizing rendered_html">
      <h4 id="Intuition-behind-PI">
       Intuition behind PI
       <a class="anchor-link" href="#Intuition-behind-PI">
        &para;
       </a>
      </h4>
      <p>
       Below is a graph that helps to visualize how the PI values are calculated. We have calculated for 3 points
       <code>
        x in [0.10, 0.6, 4]
       </code>
       .
      </p>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[21]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="k">def</span> <span class="nf">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sig</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)))</span>

<span class="k">def</span> <span class="nf">pi_cdf_plot</span><span class="p">(</span><span class="n">gp</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">x_locs</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
    <span class="sd">'''gp: trained gp</span>
<span class="sd">    x: all x pos</span>
<span class="sd">    train_X: locations sensed till now</span>
<span class="sd">    train_y: sensed functional values</span>
<span class="sd">    x_locs: points on x axis we would like to visualize pi values</span>
<span class="sd">    '''</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
    
    <span class="c1"># PI Plot</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">PI</span><span class="p">()</span>
    <span class="n">gp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">)</span>
    <span class="n">mu_plus</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">train_y</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">(</span><span class="n">gp</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">mu_plus</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"Probability of Improvement (PI)"</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"X"</span><span class="p">);</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Probability of Improvement values when eps = </span><span class="si">{</span><span class="n">eps</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    
    <span class="c1"># CDF plot</span>
    <span class="c1"># for internal calcs</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">cycle</span><span class="p">((</span><span class="s1">'g'</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">,</span> <span class="s1">'c'</span><span class="p">,</span> <span class="s1">'m'</span><span class="p">,</span> <span class="s1">'y'</span><span class="p">,</span> <span class="s1">'k'</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">))</span>
    <span class="n">y_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="n">y_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="c1"># getting correpsonding indices</span>
    <span class="n">locs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">x_loc</span> <span class="ow">in</span> <span class="n">x_locs</span><span class="p">:</span>
        <span class="n">ix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x_loc</span><span class="p">))</span>
        <span class="n">locs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ix</span><span class="p">)</span>
    
    <span class="c1"># plotting GT</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">'purple'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'GT'</span><span class="p">)</span>
    <span class="c1"># plotting preds</span>
    <span class="n">mu</span><span class="p">,</span> <span class="n">sig</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">return_std</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Predictions'</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">mu</span> <span class="o">+</span> <span class="n">sig</span><span class="p">,</span> <span class="n">mu</span> <span class="o">-</span> <span class="n">sig</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">2</span><span class="p">)</span>
    <span class="c1"># plotting mu_plus</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="n">mu_plus</span><span class="p">],</span> <span class="s1">'-.b'</span><span class="p">,</span>
             <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">'Max Detected $(\mu^+)$'</span><span class="p">)</span>
    
    <span class="n">gran</span> <span class="o">=</span> <span class="mi">1000</span>
    <span class="n">y_linspace</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="n">gran</span><span class="p">)</span>
    
    <span class="c1"># finding where y_linspace meets mu_plus</span>
    <span class="n">mu_plus_ix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">y_linspace</span> <span class="o">-</span> <span class="n">mu_plus</span><span class="p">))</span>
    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">loc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">locs</span><span class="p">):</span>
        <span class="n">color</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
        <span class="n">x_linspace</span> <span class="o">=</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">y_linspace</span><span class="p">,</span> <span class="n">mu</span><span class="p">[</span><span class="n">loc</span><span class="p">],</span> <span class="n">sig</span><span class="p">[</span><span class="n">loc</span><span class="p">])</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">loc</span><span class="p">]</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_linspace</span><span class="p">,</span> <span class="n">y_linspace</span><span class="p">,</span> <span class="s1">'--'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">loc</span><span class="p">],</span> <span class="n">mu</span><span class="p">[</span><span class="n">loc</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">th Location'</span><span class="p">)</span>
        <span class="n">mu_line</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mu_plus</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">gran</span> <span class="o">-</span> <span class="n">mu_plus_ix</span><span class="p">))</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x_linspace</span><span class="p">[</span><span class="n">mu_plus_ix</span><span class="p">:],</span>
                         <span class="n">y_linspace</span><span class="p">[</span><span class="n">mu_plus_ix</span><span class="p">:],</span>
                         <span class="n">mu_line</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"X Positions"</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"Gold Content"</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"Graph showing how PI is calculated (Shaded regions)"</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'right'</span><span class="p">)</span>
    <span class="n">format_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">format_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">"MAB_gifs/pi_cdf.svg"</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">"tight"</span><span class="p">)</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[22]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="n">pi_cdf_plot</span><span class="p">(</span><span class="n">gp</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">x_locs</span><span class="o">=</span><span class="p">[</span><span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">eps</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</pre>
       </div>
      </div>
     </div>
    </div>
    <div class="output_wrapper">
     <div class="output">
      <div class="output_area">
       <div class="prompt">
       </div>
       <div class="output_png output_subarea">
        <img src="../images/2019/bandit-learning-gp/image_12.png"/>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing text_cell rendered">
    <div class="prompt input_prompt">
    </div>
    <div class="inner_cell">
     <div class="text_cell_render border-box-sizing rendered_html">
      <p>
       <code>
        mu_plus
       </code>
       refers to the maximum functional value i.e.,
       <code>
        max(train_y)
       </code>
       , where
       <code>
        train_y
       </code>
       refers to the gold content at the currently drilled locations. We see that the probability of improvement values are calculated by finding the functional value of the cumulative density function at
       <code>
        mu_plus
       </code>
       . The Gaussian parameters for each point are the mean and standard deviation predicted from Gaussian Process Regressor for that point.
      </p>
      <h4 id="Hyperparameter:-Eps">
       Hyperparameter: Eps
       <a class="anchor-link" href="#Hyperparameter:-Eps">
        &para;
       </a>
      </h4>
      <p>
       Now we have the intuition behind how Probability of Improvement is calculated, now let's change
       <code>
        eps
       </code>
       and look at its effects.
      </p>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[23]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="n">eps</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">acq_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'eps'</span><span class="p">:</span> <span class="n">eps</span>
<span class="p">}</span>

<span class="n">dirName</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plot_acquisition</span><span class="p">(</span>
    <span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span>
    <span class="n">PI</span><span class="p">,</span> <span class="n">ylim1</span><span class="o">=</span><span class="p">((</span><span class="o">-.</span><span class="mi">05</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">)),</span>
    <span class="n">acq_params</span> <span class="o">=</span> <span class="n">acq_params</span>
<span class="p">)</span>

<span class="c1"># gify</span>
<span class="err">!</span><span class="n">convert</span> <span class="o">-</span><span class="n">delay</span> <span class="mi">40</span> <span class="o">-</span><span class="n">loop</span> <span class="mi">0</span> <span class="p">{</span><span class="n">dirName</span><span class="p">}</span><span class="o">/*.</span><span class="n">png</span> <span class="p">{</span><span class="n">gifDir</span><span class="p">}</span><span class="o">/</span><span class="n">mab</span><span class="o">-</span><span class="n">gp</span><span class="o">-</span><span class="n">pi</span><span class="o">-</span><span class="n">eps</span><span class="p">{</span><span class="n">eps</span><span class="p">}</span><span class="o">.</span><span class="n">gif</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing text_cell rendered">
    <div class="prompt input_prompt">
    </div>
    <div class="inner_cell">
     <div class="text_cell_render border-box-sizing rendered_html">
      <p>
       <img alt="" src="../images/2019/bandit-learning-gp/mab-gp-pi-eps0.01.gif"/>
      </p>
      <p>
       Looking at the graph above we can see that we are not effectively exploring at value
       <code>
        eps = 0.01
       </code>
       for the Probability of Improvement acquisition function. We are stuck.
      </p>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[24]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="n">eps</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">acq_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'eps'</span><span class="p">:</span> <span class="n">eps</span>
<span class="p">}</span>

<span class="n">dirName</span><span class="p">,</span> <span class="n">mtn_pi</span> <span class="o">=</span> <span class="n">plot_acquisition</span><span class="p">(</span>
    <span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span>
    <span class="n">PI</span><span class="p">,</span> <span class="n">ylim1</span><span class="o">=</span><span class="p">((</span><span class="o">-.</span><span class="mi">05</span><span class="p">,</span> <span class="o">.</span><span class="mi">1</span><span class="p">)),</span>
    <span class="n">acq_params</span> <span class="o">=</span> <span class="n">acq_params</span><span class="p">,</span>
    <span class="n">y1scale</span><span class="o">=</span><span class="s1">'log'</span>
<span class="p">)</span>

<span class="c1"># gify</span>
<span class="err">!</span><span class="n">convert</span> <span class="o">-</span><span class="n">delay</span> <span class="mi">40</span> <span class="o">-</span><span class="n">loop</span> <span class="mi">0</span> <span class="p">{</span><span class="n">dirName</span><span class="p">}</span><span class="o">/*.</span><span class="n">png</span> <span class="p">{</span><span class="n">gifDir</span><span class="p">}</span><span class="o">/</span><span class="n">mab</span><span class="o">-</span><span class="n">gp</span><span class="o">-</span><span class="n">pi</span><span class="o">-</span><span class="n">eps</span><span class="p">{</span><span class="n">eps</span><span class="p">}</span><span class="o">.</span><span class="n">gif</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing text_cell rendered">
    <div class="prompt input_prompt">
    </div>
    <div class="inner_cell">
     <div class="text_cell_render border-box-sizing rendered_html">
      <p>
       <img alt="" src="../images/2019/bandit-learning-gp/mab-gp-pi-eps0.5.gif"/>
      </p>
      <p>
       Looking above, we see increasing the value to
       <code>
        eps = 0.5
       </code>
       enables us to explore more and get to the maximum value which we wanted in the case of Multi-arm bandit problem. One can notice that values at $x \in [3, 4.5]$ posses uncertainty (can be identified by the grey translucent area, but as we remember we are not interested in getting the best prediction of the gold distribution, we only care about the maximum value that we can achieve, which this acquisition function with given hyper-parameters is able to capture nicely!
      </p>
      <p>
       Let's look at what happens if we increase the hyper-parameter
       <code>
        eps
       </code>
       a bit more.
      </p>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[25]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="n">eps</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">acq_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'eps'</span><span class="p">:</span> <span class="n">eps</span>
<span class="p">}</span>

<span class="n">dirName</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plot_acquisition</span><span class="p">(</span>
    <span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span>
    <span class="n">PI</span><span class="p">,</span> <span class="n">ylim1</span><span class="o">=</span><span class="p">((</span><span class="o">-.</span><span class="mi">05</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">)),</span>
    <span class="n">y1scale</span><span class="o">=</span><span class="s1">'log'</span><span class="p">,</span> <span class="n">acq_params</span> <span class="o">=</span> <span class="n">acq_params</span>
<span class="p">)</span>

<span class="c1"># gify</span>
<span class="err">!</span><span class="n">convert</span> <span class="o">-</span><span class="n">delay</span> <span class="mi">40</span> <span class="o">-</span><span class="n">loop</span> <span class="mi">0</span> <span class="p">{</span><span class="n">dirName</span><span class="p">}</span><span class="o">/*.</span><span class="n">png</span> <span class="p">{</span><span class="n">gifDir</span><span class="p">}</span><span class="o">/</span><span class="n">mab</span><span class="o">-</span><span class="n">gp</span><span class="o">-</span><span class="n">pi</span><span class="o">-</span><span class="n">eps</span><span class="p">{</span><span class="n">eps</span><span class="p">}</span><span class="o">.</span><span class="n">gif</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing text_cell rendered">
    <div class="prompt input_prompt">
    </div>
    <div class="inner_cell">
     <div class="text_cell_render border-box-sizing rendered_html">
      <p>
       <img alt="" src="../images/2019/bandit-learning-gp/mab-gp-pi-eps3.gif"/>
      </p>
      <p>
       We see that we made things worse! Our model now uses
       <code>
        eps = 3
       </code>
       which has effectively resulted in way too much exploratoration. This amount of exploration is not able to exploit when we land somewhere near a global maxima.
      </p>
      <hr/>
      <h3 id="Expected-Improvement-(EI)">
       Expected Improvement (EI)
       <a class="anchor-link" href="#Expected-Improvement-(EI)">
        &para;
       </a>
      </h3>
      <p>
       Probability of improvement only looked at
       <code>
        how likely
       </code>
       is an improvement, but, shouldn't we be looking into
       <code>
        how much
       </code>
       we can improve. The next criterion called Expected Improvement (EI) looks into both :)
      </p>
      \begin{equation}
    EI(x)=
    \begin{cases}
      (\mu(x) - \mu^+ - \epsilon)\Phi(Z) + \sigma(x)\phi(Z), &amp; \text{if}\ \sigma(x) &gt; 0 \\
      0 &amp; \text{if}\ \sigma(x) = 0 
    \end{cases}
  \end{equation}
      <p>
       $$Z= \frac{\mu(x) - \mu^+ - \epsilon}{\sigma(x)}$$
 where $\Phi(.)$ indicates CDF and $\phi(.)$ indicates pdf
      </p>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[26]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="k">class</span> <span class="nc">EI</span><span class="p">(</span><span class="n">ACQ</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">acq_fn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gp_reg</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mf">5.</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        gp_reg: sklearn.GPRegresssor</span>
<span class="sd">        mu: max value of y among the selected train_pts</span>
<span class="sd">        """</span>
        <span class="n">y_pred</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">gp_reg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">return_std</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_pred</span> <span class="o">-</span> <span class="n">mu</span> <span class="o">-</span> <span class="n">eps</span><span class="p">)</span><span class="o">/</span><span class="n">sigma</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">y_pred</span> <span class="o">-</span> <span class="n">mu</span> <span class="o">-</span> <span class="n">eps</span><span class="p">)</span><span class="o">*</span><span class="n">ndtr</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">+</span> <span class="n">sigma</span><span class="o">*</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[27]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">EI</span><span class="p">()</span>
<span class="n">gp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">)</span>
<span class="n">mu_plus</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">train_y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">5</span><span class="o">*</span><span class="n">p</span><span class="p">(</span><span class="n">gp</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">mu_plus</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"X"</span><span class="p">);</span>
</pre>
       </div>
      </div>
     </div>
    </div>
    <div class="output_wrapper">
     <div class="output">
      <div class="output_area">
       <div class="prompt">
       </div>
       <div class="output_png output_subarea">
        <img src="../images/2019/bandit-learning-gp/image_16.png"/>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[28]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="n">eps</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">acq_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'eps'</span><span class="p">:</span> <span class="n">eps</span>
<span class="p">}</span>

<span class="n">dirName</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plot_acquisition</span><span class="p">(</span>
    <span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span>
    <span class="n">EI</span><span class="p">,</span> <span class="n">ylim1</span><span class="o">=</span><span class="p">((</span><span class="o">-</span><span class="mf">0.001</span><span class="p">,</span> <span class="o">.</span><span class="mi">05</span><span class="p">)),</span>
    <span class="n">acq_params</span><span class="o">=</span><span class="n">acq_params</span><span class="p">,</span>
    <span class="n">y1scale</span><span class="o">=</span><span class="s1">'log'</span>
<span class="p">)</span>

<span class="c1"># gify!</span>
<span class="err">!</span><span class="n">convert</span> <span class="o">-</span><span class="n">delay</span> <span class="mi">40</span> <span class="o">-</span><span class="n">loop</span> <span class="mi">0</span> <span class="p">{</span><span class="n">dirName</span><span class="p">}</span><span class="o">/*.</span><span class="n">png</span> <span class="p">{</span><span class="n">gifDir</span><span class="p">}</span><span class="o">/</span><span class="n">mab</span><span class="o">-</span><span class="n">gp</span><span class="o">-</span><span class="n">ei</span><span class="o">-</span><span class="n">eps</span><span class="p">{</span><span class="n">eps</span><span class="p">}</span><span class="o">.</span><span class="n">gif</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing text_cell rendered">
    <div class="prompt input_prompt">
    </div>
    <div class="inner_cell">
     <div class="text_cell_render border-box-sizing rendered_html">
      <p>
       <img alt="" src="../images/2019/bandit-learning-gp/mab-gp-ei-eps0.01.gif"/>
      </p>
      <p>
       Like the Probability of Improvement's acquisition function, we can moderate the amount of explorability the Expected Improvement's acquisition function by setting the
       <code>
        eps
       </code>
       hyper-parameter.
      </p>
      <p>
       We see that having
       <code>
        eps = 0.01
       </code>
       primarily results in exploitation, and we are not able to get to the global maxima due to this myopic drilling location selection.
      </p>
      <p>
       Let's try increasing the
       <code>
        eps
       </code>
       variable to focus a little more on exploribility.
      </p>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[29]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="n">eps</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="n">acq_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'eps'</span><span class="p">:</span> <span class="n">eps</span>
<span class="p">}</span>

<span class="n">dirName</span><span class="p">,</span> <span class="n">mtn_ei</span> <span class="o">=</span> <span class="n">plot_acquisition</span><span class="p">(</span>
    <span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span>
    <span class="n">EI</span><span class="p">,</span> <span class="n">ylim1</span><span class="o">=</span><span class="p">((</span><span class="o">-</span><span class="mf">0.001</span><span class="p">,</span> <span class="o">.</span><span class="mi">05</span><span class="p">)),</span>
    <span class="n">acq_params</span><span class="o">=</span><span class="n">acq_params</span><span class="p">,</span>
    <span class="n">y1scale</span><span class="o">=</span><span class="s1">'log'</span>
<span class="p">)</span>

<span class="c1"># gify!</span>
<span class="err">!</span><span class="n">convert</span> <span class="o">-</span><span class="n">delay</span> <span class="mi">40</span> <span class="o">-</span><span class="n">loop</span> <span class="mi">0</span> <span class="p">{</span><span class="n">dirName</span><span class="p">}</span><span class="o">/*.</span><span class="n">png</span> <span class="p">{</span><span class="n">gifDir</span><span class="p">}</span><span class="o">/</span><span class="n">mab</span><span class="o">-</span><span class="n">gp</span><span class="o">-</span><span class="n">ei</span><span class="o">-</span><span class="n">eps</span><span class="p">{</span><span class="n">eps</span><span class="p">}</span><span class="o">.</span><span class="n">gif</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing text_cell rendered">
    <div class="prompt input_prompt">
    </div>
    <div class="inner_cell">
     <div class="text_cell_render border-box-sizing rendered_html">
      <p>
       <img alt="" src="../images/2019/bandit-learning-gp/mab-gp-ei-eps1.5.gif"/>
      </p>
      <p>
       As we expected, increasing the value to
       <code>
        eps = 1.5
       </code>
       makes the acquisition function explore more and exploit when the time comes. We see that it moves slowly once it reaches near the global maxima, trying to find the global maxima. In this case, the exploration is effectively helping us reach a higher functional value much earlier!
      </p>
      <p>
       Let's see if increasing
       <code>
        eps
       </code>
       helps us more!
      </p>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[30]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="n">eps</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">acq_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'eps'</span><span class="p">:</span> <span class="n">eps</span>
<span class="p">}</span>

<span class="n">dirName</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plot_acquisition</span><span class="p">(</span>
    <span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span>
    <span class="n">EI</span><span class="p">,</span> <span class="n">ylim1</span><span class="o">=</span><span class="p">((</span><span class="o">-</span><span class="mf">0.001</span><span class="p">,</span> <span class="o">.</span><span class="mi">05</span><span class="p">)),</span>
    <span class="n">acq_params</span><span class="o">=</span><span class="n">acq_params</span><span class="p">,</span>
    <span class="n">y1scale</span><span class="o">=</span><span class="s1">'log'</span>
<span class="p">)</span>

<span class="c1"># gify!</span>
<span class="err">!</span><span class="n">convert</span> <span class="o">-</span><span class="n">delay</span> <span class="mi">40</span> <span class="o">-</span><span class="n">loop</span> <span class="mi">0</span> <span class="p">{</span><span class="n">dirName</span><span class="p">}</span><span class="o">/*.</span><span class="n">png</span> <span class="p">{</span><span class="n">gifDir</span><span class="p">}</span><span class="o">/</span><span class="n">mab</span><span class="o">-</span><span class="n">gp</span><span class="o">-</span><span class="n">ei</span><span class="o">-</span><span class="n">eps</span><span class="p">{</span><span class="n">eps</span><span class="p">}</span><span class="o">.</span><span class="n">gif</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing text_cell rendered">
    <div class="prompt input_prompt">
    </div>
    <div class="inner_cell">
     <div class="text_cell_render border-box-sizing rendered_html">
      <p>
       <img alt="" src="../images/2019/bandit-learning-gp/mab-gp-ei-eps3.gif"/>
      </p>
      <p>
       Is this better than before? Turns out a yes and a no. We see that here we do too much exploration given the value of
       <code>
        eps = 3
       </code>
       . Which results in early reaching something close to global maxima, but unfortunately we don't exploit to get more gains near the global maxima. We would have liked an acquisition function that tried to exploit a bit more after reaching somewhere close to the global maxima. In essence:
      </p>
      <ul>
       <li>
        reach near global maxima in a lower number of iterations
       </li>
       <li>
        we don't exploit once we reach near global maxima
       </li>
      </ul>
      <hr/>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[31]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="k">def</span> <span class="nf">ei_pi_plot</span><span class="p">(</span>
        <span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span>
        <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">yscale</span><span class="o">=</span><span class="s1">'log'</span><span class="p">,</span> <span class="n">xscale</span><span class="o">=</span><span class="s1">'log'</span><span class="p">,</span>
        <span class="n">seed</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">pi_params</span><span class="o">=</span><span class="p">{},</span> <span class="n">ei_params</span><span class="o">=</span><span class="p">{},</span>
    <span class="p">):</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="n">yscale</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="n">xscale</span><span class="p">)</span>

    <span class="c1"># fitting</span>
    <span class="n">gp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>

    <span class="c1"># for plotting scatter plot</span>
    <span class="n">pi_obj</span> <span class="o">=</span> <span class="n">PI</span><span class="p">()</span>
    <span class="n">ei_obj</span> <span class="o">=</span> <span class="n">EI</span><span class="p">()</span>
    <span class="n">pi_acq</span> <span class="o">=</span> <span class="n">pi_obj</span><span class="p">(</span><span class="n">gp</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">pi_params</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">train_y</span><span class="p">))</span>
    <span class="n">ei_acq</span> <span class="o">=</span> <span class="n">ei_obj</span><span class="p">(</span><span class="n">gp</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">ei_params</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">train_y</span><span class="p">))</span>
    
    <span class="c1"># predict on current pool set</span>
    <span class="n">y_pred</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">return_std</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">pi_acq</span><span class="p">,</span> <span class="n">ei_acq</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Location'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'EI_acq value'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'PI_acq value'</span><span class="p">)</span>
    <span class="n">pi_hyperparams</span> <span class="o">=</span> <span class="s1">': HParam(s) &rarr; '</span><span class="o">+</span><span class="s1">' | '</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="s1">': '</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">pi_params</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
    <span class="n">ei_hyperparams</span> <span class="o">=</span> <span class="s1">': HParam(s) &rarr; '</span><span class="o">+</span><span class="s1">' | '</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="s1">': '</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ei_params</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
    
    <span class="c1"># limits</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span> <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span> <span class="c1"># ax.set_ylim(min(ei_acq), max(ei_acq)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span> <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span> <span class="c1"># ax.set_xlim(min(pi_acq), max(pi_acq))</span>
    
    <span class="n">strr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pi_obj</span><span class="p">)</span> <span class="o">+</span> <span class="n">pi_hyperparams</span> <span class="o">+</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ei_obj</span><span class="p">)</span> <span class="o">+</span> <span class="n">ei_hyperparams</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">strr</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s2">"upper left"</span><span class="p">)</span>
    <span class="n">format_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    
    <span class="n">pii</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">pi_params</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    <span class="n">eii</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">ei_params</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    <span class="n">params_str</span> <span class="o">=</span> <span class="s1">'-'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pii</span> <span class="o">+</span> <span class="n">eii</span><span class="p">)</span>
    <span class="n">dirName</span> <span class="o">=</span> <span class="s1">'./MAB_gifs/Ei_Pi_graph/'</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dirName</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">dirName</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.svg"</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">"tight"</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">dirName</span><span class="p">)</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[32]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="n">pi_eps</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">]</span><span class="c1">#, 0.001, 0.01, 0.1, 1]</span>
<span class="n">ei_eps</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">]</span><span class="c1">#, 0.001, 0.01, 0.1, 1]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">pi_ep</span><span class="p">,</span> <span class="n">ei_ep</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">pi_eps</span><span class="p">,</span> <span class="n">ei_eps</span><span class="p">)):</span>
    <span class="n">pi_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'eps'</span><span class="p">:</span> <span class="n">pi_ep</span><span class="p">}</span>
    <span class="n">ei_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'eps'</span><span class="p">:</span> <span class="n">ei_ep</span><span class="p">}</span>

    <span class="n">dirName</span> <span class="o">=</span> <span class="n">ei_pi_plot</span><span class="p">(</span>
        <span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span>
        <span class="n">pi_params</span> <span class="o">=</span> <span class="n">pi_params</span><span class="p">,</span>
        <span class="n">ei_params</span> <span class="o">=</span> <span class="n">ei_params</span><span class="p">,</span>
        <span class="n">yscale</span><span class="o">=</span><span class="s1">'linear'</span><span class="p">,</span> <span class="n">xscale</span><span class="o">=</span><span class="s1">'linear'</span><span class="p">,</span>
        <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span> <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">),</span>
    <span class="p">)</span>

<span class="c1"># gify!</span>
<span class="c1"># !convert -delay 50 -loop 0 {dirName}/*.png {gifDir}/ei_pi_graph.gif</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing text_cell rendered">
    <div class="prompt input_prompt">
    </div>
    <div class="inner_cell">
     <div class="text_cell_render border-box-sizing rendered_html">
      <p>
       We have seen two closely related methods, The
       <em>
        Probability of Improvement
       </em>
       and the
       <em>
        Expected Improvement
       </em>
       . We can think of these two to be related to the ideas that we commonly are familiar with
       <code>
        risk
       </code>
       and
       <code>
        gain
       </code>
       respectively.
      </p>
      <p>
       It seems natural to see how these metrics change for each of the points. We have plotted the values for both policies' acquisition function's values below, for each of the possible locations. The graph shows the relation followed between EI and PI for when we have a single training point
       <code>
        (0.5 f(0.5))
       </code>
       .
      </p>
      <p>
       <img alt="" src="../images/2019/bandit-learning-gp/0.svg"/>
      </p>
      <p>
       If we look closely, we can see if we have an equal estimated improvement as in the case with the points with
       <code>
        EI(x) = 0.4
       </code>
       it would be more beneficial to differentiate between these points which have a better value for Probability of Improvement. In other words, when
       <code>
        gain
       </code>
       s are the same, we should prioritize to choose the option with lesser
       <code>
        risk
       </code>
       . And similarly, when the
       <code>
        risk
       </code>
       s are similar, we would likely want to go with points with greater
       <code>
        gain
       </code>
       s.
      </p>
      <hr/>
      <h3 id="Gaussian-Process-Upper-Confidence-Bound-(GP_UCB)">
       Gaussian Process Upper Confidence Bound (GP_UCB)
       <a class="anchor-link" href="#Gaussian-Process-Upper-Confidence-Bound-(GP_UCB)">
        &para;
       </a>
      </h3>
      <p>
       GP_UCB is another formulation for acquisition function where we also have theoretical bounds on the number of iterations taken to reach near global maximum.
      </p>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing text_cell rendered">
    <div class="prompt input_prompt">
    </div>
    <div class="inner_cell">
     <div class="text_cell_render border-box-sizing rendered_html">
      <h3 id="Gaussian-Process-Upper-Confidence-Bound-(GP_UCB)">
       Gaussian Process Upper Confidence Bound (GP_UCB)
       <a class="anchor-link" href="#Gaussian-Process-Upper-Confidence-Bound-(GP_UCB)">
        &para;
       </a>
      </h3>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[112]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="k">class</span> <span class="nc">GP_UCB</span><span class="p">(</span><span class="n">ACQ</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">acq_fn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gp_reg</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mf">5.</span><span class="p">,</span>
               <span class="n">v</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        gp_reg: sklearn.GPRegresssor</span>
<span class="sd">        t: Iteration number (1, ..)</span>
<span class="sd">        """</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">y_pred</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">gp_reg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">return_std</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  
<span class="c1">#         print (y_pred, sigma)</span>
<span class="c1">#         print ('blah', np.log( (t**(d/2. + 2))*(np.pi**2)/(3. * delta)  ))</span>
<span class="c1">#         print ('v3', v* (2*  np.log( (t**(d/2. + 2))*(np.pi**2)/(3. * delta)  )))</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">v</span><span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span>  <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span> <span class="p">(</span><span class="n">t</span><span class="o">**</span><span class="p">(</span><span class="n">d</span><span class="o">/</span><span class="mf">2.</span> <span class="o">+</span> <span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">3.</span> <span class="o">*</span> <span class="n">delta</span><span class="p">)</span>  <span class="p">)))</span>
<span class="c1">#         print ('k', k)</span>
        <span class="k">return</span> <span class="n">y_pred</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="n">sigma</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[34]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="n">acq_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'v'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">'delta'</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">}</span>

<span class="n">dirName</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plot_acquisition</span><span class="p">(</span>
    <span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span>
    <span class="n">GP_UCB</span><span class="p">,</span> <span class="n">ylim1</span><span class="o">=</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)),</span>
    <span class="n">acq_params</span><span class="o">=</span><span class="n">acq_params</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># gify!</span>
<span class="err">!</span><span class="n">convert</span> <span class="o">-</span><span class="n">delay</span> <span class="mi">40</span> <span class="o">-</span><span class="n">loop</span> <span class="mi">0</span> <span class="p">{</span><span class="n">dirName</span><span class="p">}</span><span class="o">/*.</span><span class="n">png</span> <span class="p">{</span><span class="n">gifDir</span><span class="p">}</span><span class="o">/</span><span class="n">mab</span><span class="o">-</span><span class="n">gp</span><span class="o">-</span><span class="n">gp_ucb1</span><span class="o">-</span><span class="mf">1.</span><span class="n">gif</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing text_cell rendered">
    <div class="prompt input_prompt">
    </div>
    <div class="inner_cell">
     <div class="text_cell_render border-box-sizing rendered_html">
      <p>
       <img alt="" src="../images/2019/bandit-learning-gp/mab-gp-gp_ucb1-1.gif"/>
      </p>
      <p>
       We seem to be exploiting too much , let's increase the exploratory hyperparameters!
      </p>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[35]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="n">acq_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'v'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s1">'delta'</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">}</span>

<span class="n">dirName</span><span class="p">,</span> <span class="n">mtn_gp_ucb</span> <span class="o">=</span> <span class="n">plot_acquisition</span><span class="p">(</span>
    <span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span>
    <span class="n">GP_UCB</span><span class="p">,</span> <span class="n">ylim1</span><span class="o">=</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)),</span>
    <span class="n">acq_params</span><span class="o">=</span><span class="n">acq_params</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># gify!</span>
<span class="err">!</span><span class="n">convert</span> <span class="o">-</span><span class="n">delay</span> <span class="mi">40</span> <span class="o">-</span><span class="n">loop</span> <span class="mi">0</span> <span class="p">{</span><span class="n">dirName</span><span class="p">}</span><span class="o">/*.</span><span class="n">png</span> <span class="p">{</span><span class="n">gifDir</span><span class="p">}</span><span class="o">/</span><span class="n">mab</span><span class="o">-</span><span class="n">gp</span><span class="o">-</span><span class="n">gp_ucb3</span><span class="o">-</span><span class="mf">1.</span><span class="n">gif</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing text_cell rendered">
    <div class="prompt input_prompt">
    </div>
    <div class="inner_cell">
     <div class="text_cell_render border-box-sizing rendered_html">
      <p>
       <img alt="" src="../images/2019/bandit-learning-gp/mab-gp-gp_ucb3-1.gif"/>
      </p>
      <p>
       Using this set of hyper-parameters, we are able to get near global maxima and further "exploit" to find the global maximum. This was a result of increasing the value of
       <code>
        v
       </code>
       to
       <code>
        3
       </code>
       ; this shows that
       <code>
        v
       </code>
       gives weightage to exploration.
      </p>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[36]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="n">acq_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'v'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">'delta'</span><span class="p">:</span> <span class="mi">3</span>
<span class="p">}</span>

<span class="n">dirName</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plot_acquisition</span><span class="p">(</span>
    <span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span>
    <span class="n">GP_UCB</span><span class="p">,</span> <span class="n">ylim1</span><span class="o">=</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)),</span>
    <span class="n">acq_params</span><span class="o">=</span><span class="n">acq_params</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># gify!</span>
<span class="err">!</span><span class="n">convert</span> <span class="o">-</span><span class="n">delay</span> <span class="mi">40</span> <span class="o">-</span><span class="n">loop</span> <span class="mi">0</span> <span class="p">{</span><span class="n">dirName</span><span class="p">}</span><span class="o">/*.</span><span class="n">png</span> <span class="p">{</span><span class="n">gifDir</span><span class="p">}</span><span class="o">/</span><span class="n">mab</span><span class="o">-</span><span class="n">gp</span><span class="o">-</span><span class="n">gp_ucb1</span><span class="o">-</span><span class="mf">3.</span><span class="n">gif</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing text_cell rendered">
    <div class="prompt input_prompt">
    </div>
    <div class="inner_cell">
     <div class="text_cell_render border-box-sizing rendered_html">
      <p>
       <img alt="" src="../images/2019/bandit-learning-gp/mab-gp-gp_ucb1-3.gif"/>
      </p>
      <p>
       Setting the values of the hyperparameters  to
       <code>
        v = 1
       </code>
       and
       <code>
        delta = 3
       </code>
       results a greater exploitation.
      </p>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing text_cell rendered">
    <div class="prompt input_prompt">
    </div>
    <div class="inner_cell">
     <div class="text_cell_render border-box-sizing rendered_html">
      <hr/>
      <h3 id="Probability-of-Improvement-+-$\lambda-\--\times$-Expected-Improvement-(EI_PI)">
       Probability of Improvement + $\lambda \  \times$ Expected Improvement (EI_PI)
       <a class="anchor-link" href="#Probability-of-Improvement-+-$\lambda-\--\times$-Expected-Improvement-(EI_PI)">
        &para;
       </a>
      </h3>
      <p>
       Below we have tried to combine PI and EI using a linear combination as a combination of various acquisition function also results in an acquisition function. We can, therefore, combine any of the acquisition function and form a new one.
      </p>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[37]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="k">class</span> <span class="nc">EI_PI</span><span class="p">(</span><span class="n">ACQ</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">acq_fn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gp_reg</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mf">5.</span><span class="p">,</span> <span class="n">eps_pi</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">eps_ei</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">lam</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        gp_reg: sklearn.GPRegresssor</span>
<span class="sd">        """</span>
        <span class="n">y_pred</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">gp_reg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">return_std</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="c1"># ei</span>
        <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_pred</span> <span class="o">-</span> <span class="n">mu</span> <span class="o">-</span> <span class="n">eps_ei</span><span class="p">)</span><span class="o">/</span><span class="n">sigma</span>
        <span class="n">ei_acq</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_pred</span> <span class="o">-</span> <span class="n">mu</span> <span class="o">-</span> <span class="n">eps_ei</span><span class="p">)</span><span class="o">*</span><span class="n">ndtr</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">+</span> <span class="n">sigma</span><span class="o">*</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        
        <span class="c1"># pi</span>
        <span class="n">pi_acq</span> <span class="o">=</span> <span class="n">ndtr</span><span class="p">((</span><span class="n">y_pred</span> <span class="o">-</span> <span class="n">mu</span> <span class="o">-</span> <span class="n">eps_pi</span><span class="p">)</span><span class="o">/</span><span class="n">sigma</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pi_acq</span> <span class="o">+</span> <span class="n">lam</span> <span class="o">*</span> <span class="n">ei_acq</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[38]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="n">acq_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'eps_pi'</span><span class="p">:</span> <span class="o">.</span><span class="mi">2</span><span class="p">,</span>
    <span class="s1">'eps_ei'</span><span class="p">:</span> <span class="o">.</span><span class="mi">4</span><span class="p">,</span>
    <span class="s1">'lam'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">dirName</span><span class="p">,</span> <span class="n">mtn_ei_pi</span> <span class="o">=</span> <span class="n">plot_acquisition</span><span class="p">(</span>
    <span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span>
    <span class="n">EI_PI</span><span class="p">,</span> <span class="n">ylim1</span><span class="o">=</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)),</span>
    <span class="n">acq_params</span><span class="o">=</span><span class="n">acq_params</span><span class="p">,</span>
    <span class="n">y1scale</span><span class="o">=</span><span class="s1">'log'</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># gify!</span>
<span class="err">!</span><span class="n">convert</span> <span class="o">-</span><span class="n">delay</span> <span class="mi">40</span> <span class="o">-</span><span class="n">loop</span> <span class="mi">0</span> <span class="p">{</span><span class="n">dirName</span><span class="p">}</span><span class="o">/*.</span><span class="n">png</span> <span class="p">{</span><span class="n">gifDir</span><span class="p">}</span><span class="o">/</span><span class="n">mab</span><span class="o">-</span><span class="n">gp</span><span class="o">-</span><span class="n">ei_pi</span><span class="o">.</span><span class="n">gif</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing text_cell rendered">
    <div class="prompt input_prompt">
    </div>
    <div class="inner_cell">
     <div class="text_cell_render border-box-sizing rendered_html">
      <p>
       <img alt="" src="../images/2019/bandit-learning-gp/mab-gp-ei_pi.gif"/>
      </p>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing text_cell rendered">
    <div class="prompt input_prompt">
    </div>
    <div class="inner_cell">
     <div class="text_cell_render border-box-sizing rendered_html">
      <h3 id="Comparison-between-all-the-methods">
       Comparison between all the methods
       <a class="anchor-link" href="#Comparison-between-all-the-methods">
        &para;
       </a>
      </h3>
      <p>
       Below we have a graph showing a comparison between the methods discussed above. We have chosen the hyper-parameters that gave us the best performance during our basic hyper-parameter search.
      </p>
      <p>
       We see the
       <em>
        Random
       </em>
       method is able to find the maximum much before any of the other methods, this can be seen when we are faced with smaller spaces to find the global maximum. If we have more dimensions to
       <code>
        x
       </code>
       , searching in this space would not be so easy using random, due to what we call the curse of dimensionality.
      </p>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[39]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="n">mtns</span> <span class="o">=</span> <span class="p">[</span><span class="n">mtn_acq</span><span class="p">,</span> <span class="n">mtn_rand</span><span class="p">,</span> <span class="n">mtn_pi</span><span class="p">,</span> <span class="n">mtn_ei</span><span class="p">,</span> <span class="n">mtn_ei_pi</span><span class="p">,</span> <span class="n">mtn_gp_ucb</span><span class="p">]</span>
<span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'ACQ'</span><span class="p">,</span> <span class="s1">'Rand'</span><span class="p">,</span> <span class="s1">'PI'</span><span class="p">,</span> <span class="s1">'EI'</span><span class="p">,</span> <span class="s1">'EI_PI'</span><span class="p">,</span> <span class="s1">'GP_UCB'</span><span class="p">]</span>
<span class="n">markers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'o-'</span><span class="p">,</span> <span class="s1">'v--'</span><span class="p">,</span> <span class="s1">'^-'</span><span class="p">,</span> <span class="s1">'&lt;:'</span><span class="p">,</span> <span class="s1">'&gt;-.'</span><span class="p">,</span> <span class="s1">'8:'</span><span class="p">]</span>

<span class="n">xx</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mtns</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">mm</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">mtns</span><span class="p">,</span> <span class="n">markers</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">mm</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'# of sensors placed'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Max gold sensed'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Comparison between methods'</span><span class="p">)</span>
<span class="n">format_axes</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">"MAB_gifs/"</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">"tight"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre>
       </div>
      </div>
     </div>
    </div>
    <div class="output_wrapper">
     <div class="output">
      <div class="output_area">
       <div class="prompt">
       </div>
       <div class="output_png output_subarea">
        <img src="../images/2019/bandit-learning-gp/image_25.png"/>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing text_cell rendered">
    <div class="prompt input_prompt">
    </div>
    <div class="inner_cell">
     <div class="text_cell_render border-box-sizing rendered_html">
      <h2 id="Observation">
       Observation
       <a class="anchor-link" href="#Observation">
        &para;
       </a>
      </h2>
      <p>
       We see that the plots above show the maximum gold content detected for the case of multi-arm bandit problem vs. the number of holes drilled. Looking at the graph above we can see that for our problem Probability of Improvement performed the best among all the variants of Acquisition functions.
      </p>
      <h2 id="Conclusions">
       Conclusions
       <a class="anchor-link" href="#Conclusions">
        &para;
       </a>
      </h2>
      <p>
       We see that for the case of multi-arm bandit we have a bit different problem as compared to the active learning problem and therefore we have the different objective functions that we try to maximize for the query points.
      </p>
      <h3 id="Caution">
       Caution
       <a class="anchor-link" href="#Caution">
        &para;
       </a>
      </h3>
      <p>
       We need to take care while using Bayesian Optimization
      </p>
      <ul>
       <li>
        Scale of the features
       </li>
       <li>
        Kernel selection for Guassian Process
       </li>
      </ul>
      <h4 id="Aknowledgments">
       Aknowledgments
       <a class="anchor-link" href="#Aknowledgments">
        &para;
       </a>
      </h4>
      <ul>
       <li>
        <p>
         Nando de Freitas
        </p>
       </li>
       <li>
        <p>
         Thomas Huijskens PyData Talk - Bayesian optimisation with scikit-learn
         <a href="https://www.youtube.com/watch?v=jtRPxRnOXnk">
          https://www.youtube.com/watch?v=jtRPxRnOXnk
         </a>
        </p>
       </li>
      </ul>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing text_cell rendered">
    <div class="prompt input_prompt">
    </div>
    <div class="inner_cell">
     <div class="text_cell_render border-box-sizing rendered_html">
      <h2 id="Hyperparameter-Search">
       Hyperparameter Search
       <a class="anchor-link" href="#Hyperparameter-Search">
        &para;
       </a>
      </h2>
      <p>
       For now we have been looking at single dimensional function, i.e. $f: \mathbb{R} \texttt{ -&gt; } \mathbb{R}$ data where we needed to find the value of $\boldsymbol{x}$ where we reached global maximum. Let's move on and try to tackle real-valued functions of $n$ real variables functions, i.e. $f: \mathbb{R}^n \texttt{ -&gt; } \mathbb{R}$. We will soon see that our methods that we saw earlier for the single dimensional case can be easily ported for baesian optimization on multi-variable functions.
      </p>
      <p>
       Let's take an example of sk-learn's moons dataset.
      </p>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[40]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">make_moons</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[41]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="n">seed</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_moons</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">y</span><span class="p">)</span>
</pre>
       </div>
      </div>
     </div>
    </div>
    <div class="output_wrapper">
     <div class="output">
      <div class="output_area">
       <div class="prompt output_prompt">
        Out[41]:
       </div>
       <div class="output_text output_subarea output_execute_result">
        <pre class="prettyprint">&lt;matplotlib.collections.PathCollection at 0x7f24b3a72128&gt;</pre>
       </div>
      </div>
      <div class="output_area">
       <div class="prompt">
       </div>
       <div class="output_png output_subarea">
        <img src="../images/2019/bandit-learning-gp/image_26.png"/>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[67]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">Listofpoints</span><span class="p">):</span>
    <span class="sd">'''Given a grid of hyperparameters we fit the SVM and return</span>
<span class="sd">    the negative of validation error (we are aiming to minimize error)'''</span>
    <span class="n">Listofpoints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Listofpoints</span><span class="p">)</span>
    <span class="n">Gammas</span><span class="p">,</span> <span class="n">Cs</span> <span class="o">=</span> <span class="n">Listofpoints</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">Listofpoints</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">Gammas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Gammas</span><span class="p">)</span>
    <span class="n">Cs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Cs</span><span class="p">)</span>
    <span class="n">shpe</span> <span class="o">=</span> <span class="n">Gammas</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">Gammas</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">Cs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">accs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">C</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">Gammas</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">Cs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()):</span>
        <span class="n">clf</span> <span class="o">=</span> <span class="n">SVC</span><span class="p">(</span><span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
        <span class="n">pred_y</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">pred_y</span> <span class="o">==</span> <span class="n">y_test</span><span class="p">)</span>
        <span class="n">acc</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="n">mask</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">accs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acc</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">accs</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shpe</span><span class="p">)</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[68]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="c1"># gammas</span>
<span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="c1"># Cs</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">)))</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">'x.shape:'</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">X0</span><span class="p">,</span> <span class="n">X1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">)</span>
<span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">X0</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">X0</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">X1</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">X1</span><span class="o">.</span><span class="n">size</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span>

<span class="n">GT</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">GT</span> <span class="o">=</span> <span class="n">GT</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">X0</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'GT.shape:'</span><span class="p">,</span> <span class="n">GT</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre>
       </div>
      </div>
     </div>
    </div>
    <div class="output_wrapper">
     <div class="output">
      <div class="output_area">
       <div class="prompt">
       </div>
       <div class="output_subarea output_stream output_stdout output_text">
        <pre class="prettyprint">x.shape: (10000, 2)
GT.shape: (100, 100)
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[90]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="n">gp</span> <span class="o">=</span> <span class="n">GaussianProcessRegressor</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[91]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="c1"># getting one training sample</span>
<span class="n">train_X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">]])</span> <span class="c1"># gamma = 5, C = 10</span>
<span class="n">train_y</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">train_X</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">)</span>
</pre>
       </div>
      </div>
     </div>
    </div>
    <div class="output_wrapper">
     <div class="output">
      <div class="output_area">
       <div class="prompt">
       </div>
       <div class="output_subarea output_stream output_stdout output_text">
        <pre class="prettyprint">[[5 5]] [0.6]
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[92]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="k">def</span> <span class="nf">getPoints</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">'''Returns points in meshgrid'''</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">a</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> 
                          <span class="n">b</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span> 
                         <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pts</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[113]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="k">def</span> <span class="nf">plot_acquisition3d</span><span class="p">(</span>
        <span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span>
        <span class="n">acq_class</span><span class="p">,</span> <span class="n">acq_params</span><span class="o">=</span><span class="p">{},</span>
        <span class="n">z0lim</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">z1lim</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">it</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">seed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">drawedges</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">debug</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
    <span class="sd">"""acq_params would contain the parameters for our acq_fn"""</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="c1"># for storing the max till it iters</span>
    <span class="n">max_till_now</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># Stopping criteria is 10 iterations</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">it</span><span class="p">):</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
            <span class="n">a</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">'equal'</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="mi">0</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]))</span> <span class="c1"># C</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="mi">0</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]))</span> <span class="c1"># gamma</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="mi">0</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]))</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="mi">0</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]))</span>
        
        <span class="c1"># fitting</span>
        <span class="n">gp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
        
        <span class="c1"># plot ground truth</span>
        <span class="n">boun0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">*</span><span class="n">z0lim</span><span class="p">,</span> <span class="n">levels</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X0</span><span class="p">,</span> <span class="n">X1</span><span class="p">,</span> <span class="n">GT</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">'plasma'</span><span class="p">,</span> 
                           <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> 
                           <span class="n">vmin</span><span class="o">=</span><span class="n">z0lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
                           <span class="n">vmax</span><span class="o">=</span><span class="n">z0lim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s1">'plasma'</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="n">GT</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">set_clim</span><span class="p">(</span><span class="o">*</span><span class="n">z0lim</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">drawedges</span><span class="o">=</span><span class="n">drawedges</span><span class="p">,</span> <span class="n">boundaries</span><span class="o">=</span><span class="n">boun0</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1"># plot current training set</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">train_X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">train_X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                      <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Train points'</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s1">'first point:'</span><span class="p">,</span> <span class="n">train_X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">train_X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
        
        <span class="c1"># plot Acquisition</span>
        <span class="n">acq_obj</span> <span class="o">=</span> <span class="n">acq_class</span><span class="p">()</span>
        <span class="n">acquisition</span> <span class="o">=</span> <span class="n">acq_obj</span><span class="p">(</span><span class="n">gp</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">acq_params</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">train_y</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">'acquisition'</span><span class="p">,</span> <span class="n">acquisition</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">'gp.copy_X_train: '</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">X_train_</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">'acq function near last train point:'</span><span class="p">)</span>
        <span class="n">h2</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X0</span><span class="p">,</span> <span class="n">X1</span><span class="p">,</span> 
                            <span class="n">acquisition</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">X0</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> 
                            <span class="n">cmap</span><span class="o">=</span><span class="s1">'plasma'</span><span class="p">,</span> 
                            <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">)</span>        
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">h2</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">drawedges</span><span class="o">=</span><span class="n">drawedges</span><span class="p">)</span>
        
        <span class="n">hyperparams</span> <span class="o">=</span> <span class="s1">' | '</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="s1">': '</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">acq_params</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">acq_obj</span><span class="si">}</span><span class="s2"> &amp; It: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> &amp; HParam(s) &rarr; "</span> <span class="o">+</span> <span class="n">hyperparams</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"Gamma Values"</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"C Values"</span><span class="p">)</span>
        
        <span class="c1"># Choose the next point with highest acq</span>
        <span class="n">max_mu</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">train_y</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
        <span class="n">max_till_now</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_mu</span><span class="p">)</span>
<span class="c1">#         print(acquisition)</span>
        <span class="n">next_ix</span> <span class="o">=</span> <span class="n">rargmax</span><span class="p">(</span><span class="n">acquisition</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
        <span class="n">n_x</span> <span class="o">=</span> <span class="n">X0</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="n">next_ix</span><span class="p">],</span> <span class="n">X1</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="n">next_ix</span><span class="p">]</span>
        

        <span class="c1"># Add new point with highest uncertainty to the pool set</span>
        <span class="n">train_X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">train_X</span><span class="p">,</span> <span class="p">[</span><span class="o">*</span><span class="n">n_x</span><span class="p">]])</span>
        <span class="n">train_y</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">train_X</span><span class="p">)</span>

        <span class="c1"># Add new point with highest uncertainty to the pool set</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="n">n_x</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">'X'</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                      <span class="n">c</span><span class="o">=</span><span class="s1">'grey'</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s1">'maxima (tie randomly broken)'</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="n">n_x</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'grey'</span><span class="p">,</span>
                      <span class="n">s</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Query Point'</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"Gamma Values"</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"C Values"</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"Accuracies (Not Known)"</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s2">"upper left"</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s2">"upper left"</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

        <span class="n">acq_params_str</span> <span class="o">=</span> <span class="s1">'-'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">acq_params</span><span class="o">.</span><span class="n">values</span><span class="p">())))</span>
        <span class="n">dirName</span> <span class="o">=</span> <span class="s1">'./MAB_pngs/'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">acq_obj</span><span class="p">)</span><span class="o">+</span><span class="s1">'3d/'</span><span class="o">+</span><span class="n">acq_params_str</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dirName</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">dirName</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.png"</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">"tight"</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">dirName</span><span class="p">,</span> <span class="n">max_till_now</span><span class="p">,</span> <span class="n">train_X</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[114]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="n">eps</span> <span class="o">=</span> <span class="o">.</span><span class="mi">05</span>
<span class="n">acq_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'eps'</span><span class="p">:</span><span class="n">eps</span><span class="p">}</span>
<span class="n">dirName</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plot_acquisition3d</span><span class="p">(</span><span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> 
                   <span class="n">PI</span><span class="p">,</span> <span class="n">acq_params</span><span class="o">=</span><span class="n">acq_params</span><span class="p">,</span>
                   <span class="n">z0lim</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">40</span><span class="p">,</span> <span class="o">.</span><span class="mi">85</span><span class="p">),</span>
                   <span class="n">it</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>

<span class="c1"># gify!</span>
<span class="err">!</span><span class="n">convert</span> <span class="o">-</span><span class="n">delay</span> <span class="mi">40</span> <span class="o">-</span><span class="n">loop</span> <span class="mi">0</span> <span class="p">{</span><span class="n">dirName</span><span class="p">}</span><span class="o">/*.</span><span class="n">png</span> <span class="p">{</span><span class="n">gifDir</span><span class="p">}</span><span class="o">/</span><span class="n">pi3d</span><span class="o">-</span><span class="p">{</span><span class="n">eps</span><span class="p">}</span><span class="o">-</span><span class="n">rbf</span><span class="o">.</span><span class="n">gif</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing text_cell rendered">
    <div class="prompt input_prompt">
    </div>
    <div class="inner_cell">
     <div class="text_cell_render border-box-sizing rendered_html">
      <p>
       <img alt="" src="../images/2019/bandit-learning-gp/pi3d-0.05-rbf.gif"/>
      </p>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[117]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="n">eps</span> <span class="o">=</span> <span class="o">.</span><span class="mi">00001</span>
<span class="n">acq_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'eps'</span><span class="p">:</span><span class="n">eps</span><span class="p">}</span>
<span class="n">dirName</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plot_acquisition3d</span><span class="p">(</span><span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> 
                   <span class="n">EI</span><span class="p">,</span> <span class="n">acq_params</span><span class="o">=</span><span class="n">acq_params</span><span class="p">,</span>
                   <span class="n">z0lim</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">40</span><span class="p">,</span> <span class="o">.</span><span class="mi">85</span><span class="p">),</span>
                   <span class="n">it</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>

<span class="c1"># gify!</span>
<span class="err">!</span><span class="n">convert</span> <span class="o">-</span><span class="n">delay</span> <span class="mi">40</span> <span class="o">-</span><span class="n">loop</span> <span class="mi">0</span> <span class="p">{</span><span class="n">dirName</span><span class="p">}</span><span class="o">/*.</span><span class="n">png</span> <span class="p">{</span><span class="n">gifDir</span><span class="p">}</span><span class="o">/</span><span class="n">ei3d</span><span class="o">-</span><span class="p">{</span><span class="n">eps</span><span class="p">}</span><span class="o">.</span><span class="n">gif</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing text_cell rendered">
    <div class="prompt input_prompt">
    </div>
    <div class="inner_cell">
     <div class="text_cell_render border-box-sizing rendered_html">
      <p>
       <img alt="" src="MAB_gifs/ei3d-0.00001.gif"/>
      </p>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[118]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span><span class="n">v</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">delta</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">acq_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'v'</span><span class="p">:</span><span class="n">v</span><span class="p">,</span>
    <span class="s1">'delta'</span><span class="p">:</span><span class="n">delta</span>
<span class="p">}</span>

<span class="n">dirName</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plot_acquisition3d</span><span class="p">(</span><span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> 
                   <span class="n">GP_UCB</span><span class="p">,</span> <span class="n">acq_params</span><span class="o">=</span><span class="n">acq_params</span><span class="p">,</span>
                   <span class="n">z0lim</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">40</span><span class="p">,</span> <span class="o">.</span><span class="mi">85</span><span class="p">),</span>
                   <span class="n">it</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>

<span class="c1"># gify!</span>
<span class="err">!</span><span class="n">convert</span> <span class="o">-</span><span class="n">delay</span> <span class="mi">40</span> <span class="o">-</span><span class="n">loop</span> <span class="mi">0</span> <span class="p">{</span><span class="n">dirName</span><span class="p">}</span><span class="o">/*.</span><span class="n">png</span> <span class="p">{</span><span class="n">gifDir</span><span class="p">}</span><span class="o">/</span><span class="n">gp3d</span><span class="o">-</span><span class="p">{</span><span class="n">v</span><span class="p">}</span><span class="o">-</span><span class="p">{</span><span class="n">delta</span><span class="p">}</span><span class="o">.</span><span class="n">gif</span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing text_cell rendered">
    <div class="prompt input_prompt">
    </div>
    <div class="inner_cell">
     <div class="text_cell_render border-box-sizing rendered_html">
      <p>
       <img alt="" src="../images/2019/bandit-learning-gp/gp3d-1-2.gif"/>
      </p>
     </div>
    </div>
   </div>
   <div class="cell border-box-sizing code_cell rendered">
    <div class="input">
     <div class="prompt input_prompt">
      In&nbsp;[&nbsp;]:
     </div>
     <div class="inner_cell">
      <div class="input_area">
       <div class="highlight hl-ipython3">
        <pre class="prettyprint"><span></span>
</pre>
       </div>
      </div>
     </div>
    </div>
   </div>
   <script crossorigin="anonymous" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" src="https://code.jquery.com/jquery-3.2.1.min.js">
   </script>
   <script src="https://cdn.jsdelivr.net/jquery.jssocials/1.4.0/jssocials.min.js" type="text/javascript">
   </script>
   <link href="https://cdn.jsdelivr.net/jquery.jssocials/1.4.0/jssocials.css" rel="stylesheet" type="text/css"/>
   <link href="https://cdn.jsdelivr.net/jquery.jssocials/1.4.0/jssocials-theme-flat.css" rel="stylesheet" type="text/css"/>
   <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
   <!--
Script to remove the notebook prompt:
In[12]
Out[12]
-->
   <script>
    var prompts = document.getElementsByClassName('prompt');

    while(prompts[0]) {
    prompts[0].parentNode.removeChild(prompts[0]);
    }
   </script>
   <div class="container">
    <div class="navbar-static-bottom" id="share">
    </div>
    <script>
     $("#share").jsSocials({
                    shares: ["email", "twitter", "facebook", "linkedin", "pinterest", "stumbleupon", "whatsapp"]
                });
    </script>
    <div id="disqus_thread">
    </div>
    <script>
     (function() { // DON'T EDIT BELOW THIS LINE
                var d = document, s = d.createElement('script');
                    s.src = 'https://hemanta212.disqus.com/embed.js';
                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
                })();
    </script>
    <noscript>
     Please enable JavaScript to view the
     <a href="https://disqus.com/?ref_noscript">
      comments powered by Disqus.
     </a>
    </noscript>
    <script async="" id="dsq-count-scr" src="//hemanta212.disqus.com/count.js">
    </script>
   </div>
   <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js?lang=css&amp;lag=html&amp;lang=py&amp;lang=sh&amp;lang=bsh&amp;lang=js&amp;">
   </script>
   <link href="../../assets/css/light_theme.css" rel="stylesheet"/>
  </div>
 </body>
</html>